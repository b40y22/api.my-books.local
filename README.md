# My Books Backend API

## –û–≥–ª—è–¥ –ø—Ä–æ–µ–∫—Ç—É

–¶–µ Laravel-based API –¥–ª—è —Å–∏—Å—Ç–µ–º–∏ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–Ω–∏–≥–∞–º–∏ –∑ –ø–æ–≤–Ω–∏–º –ª–æ–≥—É–≤–∞–Ω–Ω—è–º –∂–∏—Ç—Ç—î–≤–æ–≥–æ —Ü–∏–∫–ª—É HTTP-–∑–∞–ø–∏—Ç—ñ–≤ —Ç–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è–º –∞–Ω–∞–ª—ñ—Ç–∏—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö —É MongoDB.

## –û—Å–Ω–æ–≤–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ

- üîê –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó (—Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è, –ª–æ–≥—ñ–Ω, –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–∞—Ä–æ–ª—é)
- üìö API –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–Ω–∏–≥–∞–º–∏
- üìä **–ü–æ–≤–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –∂–∏—Ç—Ç—î–≤–æ–≥–æ —Ü–∏–∫–ª—É –∑–∞–ø–∏—Ç—ñ–≤ –∑ MongoDB**
- üîç –ê–Ω–∞–ª—ñ–∑ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —Ç–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥
- ‚ö° –ê—Ä—Ç–∏–∑–∞–Ω—Å—å–∫–∞ –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É –∑–∞–ø–∏—Ç—ñ–≤

## –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –ª–æ–≥—É–≤–∞–Ω–Ω—è

### –°–∏—Å—Ç–µ–º–∞ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª—ñ–∑—É—î –∫–æ–º–ø–ª–µ–∫—Å–Ω—É —Å–∏—Å—Ç–µ–º—É –ª–æ–≥—É–≤–∞–Ω–Ω—è, —è–∫–∞ –≤—ñ–¥—Å—Ç–µ–∂—É—î –∫–æ–∂–µ–Ω HTTP-–∑–∞–ø–∏—Ç –≤—ñ–¥ –ø–æ—á–∞—Ç–∫—É –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è:

#### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ —Å–∏—Å—Ç–µ–º–∏ –ª–æ–≥—É–≤–∞–Ω–Ω—è

1. **RequestTrackingMiddleware** (`app/Http/Middleware/RequestTrackingMiddleware.php`)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥—Å—Ç–µ–∂—É—î –≤—Å—ñ HTTP-–∑–∞–ø–∏—Ç–∏
   - –ì–µ–Ω–µ—Ä—É—î —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π ID –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É
   - –î–æ–¥–∞—î `X-Request-ID` –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ

2. **RequestLogger Service** (`app/Services/RequestLogger.php`)
   - –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∏–π —Å–µ—Ä–≤—ñ—Å –¥–ª—è –∑–±–∏—Ä–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –ø—Ä–æ –∑–∞–ø–∏—Ç–∏
   - –ó–±–∏—Ä–∞—î –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
   - –í—ñ–¥—Å—Ç–µ–∂—É—î SQL-–∑–∞–ø–∏—Ç–∏ —Ç–∞ —ó—Ö —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
   - –õ–æ–≥—É—î –≤–∏–∫–ª—é—á–µ–Ω–Ω—è —Ç–∞ –ø–æ–º–∏–ª–∫–∏

3. **MongoServiceProvider** (`app/Providers/MongoServiceProvider.php`)
   - –ù–∞–ª–∞—à—Ç–æ–≤—É—î –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ MongoDB
   - –°—Ç–≤–æ—Ä—é—î —ñ–Ω–¥–µ–∫—Å–∏ –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ—ó –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤—É—î TTL –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ (30 –¥–Ω—ñ–≤)

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö –≤ MongoDB

–ö–æ–∂–µ–Ω –∑–∞–ø–∏—Ç –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —è–∫ –æ–∫—Ä–µ–º–∏–π –¥–æ–∫—É–º–µ–Ω—Ç —ñ–∑ —Ç–∞–∫–æ—é —Å—Ç—Ä—É–∫—Ç—É—Ä–æ—é:

```json
{
  "_id": "uuid-–∑–∞–ø–∏—Ç—É",
  "started_at": "2025-06-16T10:30:00.000Z",
  "finished_at": "2025-06-16T10:30:00.250Z",
  "method": "POST",
  "url": "https://api.example.com/auth/login",
  "status": 200,
  "duration_ms": 250.75,
  "ip": "192.168.1.100",
  "user_agent": "Mozilla/5.0...",
  "user_id": 123,
  "input": {
    "email": "user@example.com"
  },
  "query_count": 3,
  "db_time_ms": 45.2,
  "queries": [
    {
      "sql": "SELECT * FROM users WHERE email = ?",
      "bindings": ["user@example.com"],
      "time_ms": 15.3,
      "timestamp": "2025-06-16T10:30:00.100Z"
    }
  ],
  "events": [
    {
      "event": "[middleware] request_started",
      "timestamp": "2025-06-16T10:30:00.000Z",
      "data": {
        "method": "POST",
        "url": "https://api.example.com/auth/login"
      }
    }
  ],
  "errors": [
    {
      "class": "App\\Exceptions\\ValidationException",
      "message": "Validation failed",
      "file": "/app/Http/Requests/LoginRequest.php",
      "line": 25,
      "trace": "Stack trace..."
    }
  ]
}
```

### –ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –∞–Ω–∞–ª—ñ–∑—É

#### –ê—Ä—Ç–∏–∑–∞–Ω—Å—å–∫–∞ –∫–æ–º–∞–Ω–¥–∞ `requests:analyze`

–ü–æ—Ç—É–∂–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É –∑—ñ–±—Ä–∞–Ω–∏—Ö –¥–∞–Ω–∏—Ö:

```bash
# –ê–Ω–∞–ª—ñ–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–ø–∏—Ç—É
php artisan requests:analyze {request-id}

# –ü–æ–∫–∞–∑–∞—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
php artisan requests:analyze --stats

# –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö
php artisan requests:analyze --user=123 --method=POST --status=500
php artisan requests:analyze --slow=1000 --errors
php artisan requests:analyze --from="2025-06-01" --to="2025-06-16"

# –†—ñ–∑–Ω—ñ —Ñ–æ—Ä–º–∞—Ç–∏ –≤–∏–≤–æ–¥—É
php artisan requests:analyze --format=json
php artisan requests:analyze --format=detailed
```

#### –ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó

- **–ü–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É**: `--user=ID`
- **–ü–æ HTTP –º–µ—Ç–æ–¥—É**: `--method=GET|POST|PUT|DELETE`
- **–ü–æ —Å—Ç–∞—Ç—É—Å –∫–æ–¥—É**: `--status=200|404|500`
- **–ü–æ URL**: `--url=pattern`
- **–ü–æ–≤—ñ–ª—å–Ω—ñ –∑–∞–ø–∏—Ç–∏**: `--slow=1000` (–º—ñ–ª—ñ—Å–µ–∫—É–Ω–¥–∏)
- **–¢—ñ–ª—å–∫–∏ –ø–æ–º–∏–ª–∫–∏**: `--errors`
- **–ß–∞—Å–æ–≤–∏–π –¥—ñ–∞–ø–∞–∑–æ–Ω**: `--from` —Ç–∞ `--to`

#### –°—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω—ñ –∑–≤—ñ—Ç–∏

```bash
php artisan requests:analyze --stats
```

–ü–æ–∫–∞–∑—É—î:
- –†–æ–∑–ø–æ–¥—ñ–ª —Å—Ç–∞—Ç—É—Å –∫–æ–¥—ñ–≤
- –†–æ–∑–ø–æ–¥—ñ–ª HTTP –º–µ—Ç–æ–¥—ñ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
- –ù–∞–π—á–∞—Å—Ç—ñ—à—ñ –ø–æ–º–∏–ª–∫–∏

## –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

### –í–∏–º–æ–≥–∏

- PHP 8.2+
- Laravel 12.0+
- MongoDB 4.4+
- Composer

### –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è

1. –ö–ª–æ–Ω—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π:
```bash
git clone <repository-url>
cd apps/backend
```

2. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ:
```bash
composer install
npm install
```

3. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ:
```bash
cp .env.example .env
php artisan key:generate
```

4. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ MongoDB —É `.env`:
```env
MONGODB_DSN=mongodb://localhost:27017
MONGODB_DATABASE=my_books
MONGODB_REQUEST_COLLECTION=requests
```

5. –ó–∞–ø—É—Å—Ç—ñ—Ç—å –º—ñ–≥—Ä–∞—Ü—ñ—ó:
```bash
php artisan migrate
```

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è MongoDB

–£ `config/database.php` –¥–æ–¥–∞–Ω–æ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é –¥–ª—è MongoDB:

```php
'mongodb' => [
    'dsn' => env('MONGODB_DSN'),
    'database' => env('MONGODB_DATABASE', 'my_books'),
    'request_tracking_collection' => env('MONGODB_REQUEST_COLLECTION', 'requests'),
    'options' => [
        'connectTimeoutMS' => 3000,
        'socketTimeoutMS' => 5000,
    ],
],
```

## –†–æ–∑—Ä–æ–±–∫–∞

### –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç—É

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å—ñ—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ (—Å–µ—Ä–≤–µ—Ä, —á–µ—Ä–≥–∞, –ª–æ–≥–∏, Vite)
composer run dev

# –ê–±–æ –æ–∫—Ä–µ–º–æ
php artisan serve
php artisan queue:listen
npm run dev
```

### –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

```bash
composer run test
# –∞–±–æ
php artisan test
```

### Linting

```bash
./vendor/bin/pint
```

## –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–∞ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∞

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ MongoDB

```php
use App\Services\RequestLogger;

if (RequestLogger::isMongoAvailable()) {
    // MongoDB –¥–æ—Å—Ç—É–ø–Ω–∞
}
```

### –î–æ–¥–∞–≤–∞–Ω–Ω—è –∫–∞—Å—Ç–æ–º–Ω–∏—Ö –ø–æ–¥—ñ–π

```php
use App\Services\RequestLogger;

RequestLogger::addEvent('user_action', [
    'action' => 'book_created',
    'book_id' => $book->id
]);
```

### –õ–æ–≥—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ

–í—Å—ñ SQL-–∑–∞–ø–∏—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ª–æ–≥—É—é—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Laravel DB —Å–æ–±—ã—Ç—ñ–π. –ö–æ–∂–µ–Ω –∑–∞–ø–∏—Ç –≤–∫–ª—é—á–∞—î:
- SQL –∑ –ø—Ä–∏–≤'—è–∑–∞–Ω–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- –ß–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
- Timestamp

## API Endpoints

### –ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è

- `POST /api/auth/register` - –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- `POST /api/auth/login` - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è
- `POST /api/auth/logout` - –í–∏—Ö—ñ–¥
- `POST /api/auth/forgot-password` - –ó–∞–ø–∏—Ç –Ω–∞ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–∞—Ä–æ–ª—é
- `POST /api/auth/reset-password` - –°–∫–∏–¥–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—é
- `POST /api/auth/verify-email` - –í–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—è email

### –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥

–ö–æ–∂–µ–Ω API-–∑–∞–ø–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ª–æ–≥—É—î—Ç—å—Å—è —Ç–∞ –¥–æ—Å—Ç—É–ø–Ω–∏–π –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É —á–µ—Ä–µ–∑ `requests:analyze` –∫–æ–º–∞–Ω–¥—É.

## –ë–µ–∑–ø–µ–∫–∞

- –ü–∞—Ä–æ–ª—ñ –Ω–µ –ª–æ–≥—É—é—Ç—å—Å—è (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∫–ª—é—á–∞—é—Ç—å—Å—è –∑ `input`)
- MongoDB –∑'—î–¥–Ω–∞–Ω–Ω—è –∑–∞—Ö–∏—â–µ–Ω–µ —Ç–∞–π–º–∞—É—Ç–∞–º–∏
- TTL –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ (30 –¥–Ω—ñ–≤) –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –æ—á–∏—â–µ–Ω–Ω—è

## –Ü–Ω–¥–µ–∫—Å–∏ MongoDB

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—Ç–≤–æ—Ä—é—î –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω—ñ —ñ–Ω–¥–µ–∫—Å–∏:
- `_id` (–ø–µ—Ä–≤–∏–Ω–Ω–∏–π –∫–ª—é—á)
- `started_at` (—Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –∑–∞ –¥–∞—Ç–æ—é)
- `user_id + started_at` (–∑–∞–ø–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞)
- `status + started_at` (—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –∑–∞ —Å—Ç–∞—Ç—É—Å–æ–º)
- `duration_ms` (–∞–Ω–∞–ª—ñ–∑ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ)
- TTL —ñ–Ω–¥–µ–∫—Å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Å—Ç–∞—Ä–∏—Ö –∑–∞–ø–∏—Å—ñ–≤

## –¢–µ—Ö–Ω—ñ—á–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è

### –ñ–∏—Ç—Ç—î–≤–∏–π —Ü–∏–∫–ª –∑–∞–ø–∏—Ç—É

1. **–ü–æ—á–∞—Ç–æ–∫ –∑–∞–ø–∏—Ç—É** - `RequestTrackingMiddleware` –≥–µ–Ω–µ—Ä—É—î —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π ID
2. **–ó–±–∏—Ä–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö** - `RequestLogger` –∑–±–∏—Ä–∞—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∑–∞–ø–∏—Ç
3. **–í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è SQL** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö database –∑–∞–ø–∏—Ç—ñ–≤
4. **–û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫** - –õ–æ–≥—É–≤–∞–Ω–Ω—è –≤–∏–∫–ª—é—á–µ–Ω—å —Ç–∞ –ø–æ–º–∏–ª–æ–∫
5. **–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è** - –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤—Å—ñ—Ö –¥–∞–Ω–∏—Ö —É MongoDB

### –§–∞–π–ª–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó

- `config/database.php:51-67` - –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è MongoDB –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
- `app/Providers/MongoServiceProvider.php:45-66` - –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ–Ω–¥–µ–∫—Å—ñ–≤
- `app/Http/Middleware/RequestTrackingMiddleware.php` - Middleware –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è

## –õ—ñ—Ü–µ–Ω–∑—ñ—è

MIT License